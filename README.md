# call-convergence-2025
## Contact call convergence in vampire bats

### This project is in progress. Please contact Julia Vrtilek (jkvrtilek@gmail.com) and Gerald Carter (gcarter1640@gmail.com) for more information.
### README last updated June 2025.

<img src="https://user-images.githubusercontent.com/13193023/92195916-49f4b600-ee2b-11ea-90f3-75c0eea7e1b0.png" width="50px"/>

This project uses a large dataset of vampire bat contact calls.

Scripts used for analyses are provided here in R format (.R extension). Data to reproduce these results is available on figshare: Vrtilek, Julia K.; Smith-Vidaurre, Grace; Carter, Gerald (2025).

Data for "Vocal convergence during formation of cooperative relationships in vampire bats". figshare. Dataset. https://doi.org/10.6084/m9.figshare.29191334.v1

Folders named after R scripts contain items referred to in script and items generated by script, excluding items that will be required by future scripts.


This folder or directory has 6 scripts that should be run sequentially:

1. 01_get_acoustic_measuresXX.R

	- *Input data available on Figshare.* https://doi.org/10.6084/m9.figshare.29191334.v1
	- Combines results from warbleR::spectro_analysis and fundamental frequency contour summary measures into one data frame.
	- *Product available on Figshare.* https://doi.org/10.6084/m9.figshare.29191334.v1
	
2. 02_transform_acoustic_measuresXX.R

    - *Input data available on Figshare.* https://doi.org/10.6084/m9.figshare.29191334.v1
    - Converts time variables into percentages
    - Scales all numeric variables to remove units
    - Removes calls with no fundamental frequency measures
    - *Product available on Figshare.* https://doi.org/10.6084/m9.figshare.29191334.v1
  
3. 03_get_vocal_distancesXX.R

    - *Input data available on Figshare.* https://doi.org/10.6084/m9.figshare.29191334.v1
    - Filters calls by minimum sample size
    - Generates plot showing number of bats included in analysis based on given minimum number of calls per bat
    - Classifies calls to bat using DFA (discriminant function analysis) with cross-validation (leave one-out classification) to get classification accuracy, generates classification matrix
    - Classifies calls to bat using a single DFA without cross validation to get vocal distances between bats, generates vocal distance matrix
    - Compares accuracy for DFAs with and without cross-validation, generates plot given minimum sample size
    - Gets and saves DFA loadings sorted by absolute value of LD1
    - Optional: compares observed accuracy to random classification rates (expected accuracies), generates csv and plot
    - *Product: vocal-distance-94-bats.csv*  

4. 04_combine_vocal_social_dataXX.R

    - Combines vocal data generated in 03_get_vocal_distancesXX.R with social data (see Figshare).
    - *Product: vocal_social_data.csv*  

5. 05_fit_modelsXX.R

    - MODEL 1: Does kinship predict contact call similarity?
    - MODEL 2: does kinship predict contact call similarity when conditioning on social experience?
    - MODEL 3: Does time together among non-kin predict contact call similarity?
    - MODEL 4: Does within-group contact rate predict contact call similarity?
    - MODEL 5: Does within-group non-kin food sharing predict contact call similarity?  
    
6. 06_test_convergence_over_timeXX.R

    - Creates figure showing all the recording dates for a subset of bats
          - 7 bats recorded pre- and post-introduction to a group of unfamiliar bats
          - the group of 5 unfamiliar bats
    - Classifies calls to bat using a single DFA without cross validation to get vocal distances between bats
          - For pre-introduction calls and unfamiliar bat calls
          - For post-introduction calls and now-familiar bat calls
    - Mantel test to compare similarity matrix with familiarity matrix
    - Finds number of introduced and familiar dyads with increased similarity
    - Runs a permuted DFA to determine classification accuracy
          - For pre-introduction calls and unfamiliar bat calls
          - For post-introduction calls and now-familiar bat calls    
  
  
Folders:
1. 00_detection_measurement

This folder contains R code that was run on the Ohio Supercomputer to detect and measure WAV recordings of bats, the sbatch scripts used to run the R code, and txt files for the sbatch scripts to use. The original 200GB of WAV files required to replicate our data extraction are not yet available to the public.

    - Downsamples recordings that were originally sampled above 250kHz (downsamp.R, downsamp.sbatch)
    - Finds selections that might be bat calls for each recording (energyDetectorOSC.R, runEnergyDetectorOSC.R, runEnergyDetectorOSC.sbatch, filepaths.txt)
    - Collects errors generated by energyDetector (errorLogFromTXTs.R)
    - Compiles selection tables generated by energyDetector into one large table (selectionTableFromCSVs.R, selectionTableFromCSVs.sbatch)
    - Makes "extended selection tables" - R objects with WAV clips attached - for each bat-recording session combination (dsMakeExtSelTables.R, dsMakeExtSelTables.sbatch, dsExtSelTables.txt)
    - Runs warbleR function "spectro_analysis" to collect 27 measures for each selection (ds_spectro_analysis.R, ds_spectro_analysis.sbatch)
    - Makes extended selection tables and runs warbleR function "spectro_analysis" in batches of 100 on bat-recording session combinations where some selections fail (smallExtSelTables.R, smallExtSelTables.sbatch, smallExtSelables.txt; ds_spectro_for_small.R)
    - Combines results of two above bullet points (makeGiantSpecan.R, makeGiantSpecan.sbatch; makeSmallSpecan.R; combineSpecans.R)
    - Gets fundamental frequency contours for each selection (ds_fundamentalfreq.R, ds_fundamentalfreq.sbatch)
    - Compiles fundamental frequency contours into one object per bat (ds_fundbybat.R, ds_fundbybat.sbatch, bats.txt)
    - Gets and compiles summary measures of the fundamental frequency contours (get_ff_measures3.R, get_ff_measures.sbatch, ff_list.txt; makeGiantFundFreq.R, makeGiantFundFreq.sbatch)
    - Generates 5 random spectrograms from each recording session for bats that were recorded at least 4 separate times, in order to select a representative variation in contact calls within and between bats - see Figure S1 (spectro_variation_fig2.R, spec_variation_fig folder)

2. 03_get_vocal_distances

    - Plots justifying selected minimum sample size (accuracy-with-and-without-cross-validation-[samplesize].pdf)
    - CSV and plot showing number of bats included in analysis based on given minimum number of calls per bat (n_calls_by_n_bats.csv and .pdf)
    - Cross-validated DFA classification rates (cross-validated-dfa-classification.csv)
    - DFA loadings sorted by absolute value of LD1 (dfa-loadings-94-bats.csv)
    - CSV list of random classification rates (expected accuracies) and plot showing how observed accuracy compares (observed_vs_expected_accuracy.csv and .pdf)  
  
3. 05_fit_models

    - Folder containing all figures generated by this code that were published in the paper (publicationfigures)
    - Plot of contact call similarity vs. grooming rates (grooming_plot.pdf)
    - Summary plot of all models generated (summary_plot.pdf)
    - CSV of all model results (model_results.csv)
    - R workspace, will load all relevant data without having to run the models  
    
4. 06_test_convergence_over_time

    - Plot of recording dates for pre/post-introduction bats
    - pDFA results for bats pre-introduction with unfamiliar bats
    - pDFA results for bats post-instruction with now-familiar bats
  

Files:

1. Generated by 03_get_vocal_distancesXX.R

    - CSV of vocal distance matrix (vocal-distance-94-bats.csv)  

2. Used in 04_combine_vocal_social_dataXX.R

    - CSV of all vampire bat social interactions (2010-2019_vamp_social_interactions01.csv)
    - CSV explaining definition of all variables in above (2010-2019_vamp_social_interactions01-VARIABLES_EXPLANATION.csv)
    - CSV of kinship between bats, some dyads unknown (kinship-all-bats01.csv)
    - CSV of sexes and (known) ages of bats (sex_age02.csv)  

3. Generated by 04_combine_vocal_social_dataXX.R

    - Combined vocal and social data for modeling (vocal_social_data.csv)  
    
4. Used in 06_similarity_over_timeXX.R

    - CSV of all introduction dates for bats introduced to each other in 2016 (first_contact_events2016.csv)


#### Julia Vrtilek, PhD Candidate
#### jkvrtilek@gmail.com
#### Ohio State University, Columbus, OH, USA